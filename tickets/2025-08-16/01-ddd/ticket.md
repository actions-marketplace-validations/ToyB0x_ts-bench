# ddd

## 概要
- refactor repository with concept of ddd monorepo

## 目的
- 現在のリポジトリはレポート表示の調整、Web画面の変更、診断処理の変更などが混在しており、DDDの概念に基づいて整理することで、各機能の責任範囲を明確にし、保守性と拡張性を高め、デグレのリスクを減らすことを目的とする。
- モノレポ内の内部パッケージの適切な粒度を定義し、各パッケージが独立して開発・テストできるようにする。
  - 上記モノレポ内パッケージの一部で、DDDがかなり有効なパッケージのみ、軽量なヘキサゴナルアーキテクチャを採用し、ドメインロジックを中心に据えた設計を行う。
  - モノレポ内のそれぞれの内部パッケージはDDDのコンテキスト境界と似た概念に基づいて整理する

## 要件
- モノレポ内の内部パッケージが適切な粒度を定義、整理されていること
- 一部のパッケージでヘキサゴナルアーキテクチャが採用され、ドメインロジックが中心に据えられていること

## 受け入れ基準
- モノレポ内の内部パッケージが適切な粒度で整理されていることを確認するためのドキュメントが作成されていること

## 備考
- 開発者は私一人なので、重厚な設計ではなく、コード量が少なくシンプルである設計も重視しつつ、コンテキスト境界を意識した設計とのバランスをとる

## Additional Information

> リファクタリングについて確認させてください：

1. 現在の課題の優先度

最も問題となっている点はどれですか？
- A) レポート表示のロジックが複雑になっている
- B) Web画面とCLIツールでコードの重複が多い
- C) TypeScript診断処理の変更時の影響範囲が大きい
- D) データベース層の責任が不明確
- E) その他（具体的に教えてください）

- 答え: A, C

2. ヘキサゴナルアーキテクチャの適用範囲

どのパッケージで特にドメインロジックを重視したいですか？（複数選択可）
- A) TypeScript診断・分析ロジック（@ts-bench/analyzer）
- B) レポート生成ロジック
- C) データベース操作
- D) AI分析・インサイト生成
- E) その他

- 答え: E (既存の具体的なパッケージのみを対象にするというよりは、そもそものあるべきパッケージ構造とパッケージ間の関係性を考え、特にドメイン層として切り出せる部部は packages/domain などのパッケージとして独立させることも検討)

3. コンテキスト境界の整理

以下のどの粒度でパッケージを分割するのが適切と考えますか？
- A) 機能別（診断、レポート、UI、データ永続化など）
- B) レイヤー別（ドメイン、アプリケーション、インフラストラクチャ）
- C) サブドメイン別（TypeScript分析、パフォーマンス最適化、レポーティングなど）
- D) ハイブリッド（一部機能別、一部レイヤー別）

- 答え: AまたはC(共通のコアドメインやコアモデル、コアエンティティを扱うパッケージと、それをImportして使うパッケージなどの関係性を意識しつつ、DDDのコンテキスト境界を意識したパッケージ分割を行う。あるドメインサービスが別のドメインサービスにパッケージimport経由で依存することを許容、活用して整理する)

4. 既存コードの扱い

- A) 段階的に移行（新機能から適用）
- B) 一度に全体をリファクタリング
- C) 重要な部分から優先的に移行

- 答え: C または 既存コードは残したまま、新しい設計のパッケージ群をお互いが干渉しないように両立させる (相互にimportしない。するとしてもDBパッケージなどの最低限のみ)

5. パッケージ間の依存関係

理想的な依存の方向はどれですか？
- A) 単方向の依存（上位層→下位層のみ）
- B) 共有パッケージを中心とした依存
- C) 各パッケージが独立（最小限の依存）

- 答え: A,Bを必要に応じて活用
